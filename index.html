<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tudima - Pedidos</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffc107">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="application-name" content="Tudima - Pedidos">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Tudima - Pedidos">
  <meta name="mobile-web-app-capable" content="yes">

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('Service Worker registrado:', reg))
          .catch(err => console.error('Erro ao registrar SW:', err));
      });
    }
  </script>

  <style>
    body, html {
      height: 100%; margin: 0; font-family: Arial, sans-serif; background: #fff9cc;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    header { text-align: center; padding: 1rem; position: absolute; top: 0; width: 100%; }
    .logo { max-width: 150px; }

    /* Home screen buttons */
    #home { display: flex; gap: 3rem; justify-content: center; align-items: center; height: 80vh; }
    .home-button {
      background-color: #ffc107; border: none; border-radius: 20px;
      width: 160px; height: 160px; display: flex; flex-direction: column;
      align-items: center; justify-content: center; color: white;
      font-weight: bold; font-size: 1.2rem; cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: background-color 0.3s;
    }
    .home-button:hover { background-color: #e6b800; }
    .home-button .icon { font-size: 3.5rem; margin-bottom: 0.5rem; }

    .hidden { display: none !important; }
    .form-container, .list-container {
      width: 90%; max-width: 400px; margin: 2rem auto;
    }
    input, textarea, select {
      width: 100%; margin: 0.5rem 0; padding: 0.75rem;
      font-size: 1rem; border: 1px solid #ccc; border-radius: 10px;
    }
    button {
      width: 100%; padding: 0.8rem; font-size: 1rem;
      border: none; border-radius: 10px; margin-top: 0.5rem;
      cursor: pointer; color: white;
    }
    .save-button { background-color: #00c851; }
    .delete-button { background-color: #ff4444; }
    .back-button { background-color: #999; }

    .pedido-button {
      width: 100%; margin: 0.3rem 0; padding: 1rem;
      font-size: 1.1rem; font-weight: bold; border: none;
      border-radius: 10px; color: white; text-align: left;
    }
    .pedido-data { font-size: 0.9rem; color: #222; opacity: 0.7; }
    .afazer { background-color: #ff4444; }
    .fazendo { background-color: #ffbb33; }
    .concluido { background-color: #00c851; }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Tudima Logo" class="logo" />
  </header>

  <main>
    <!-- Home buttons -->
    <div id="home">
      <button class="home-button" id="btnHomeCadastro">
        <div class="icon">üìù</div>
        Cadastro
      </button>
      <button class="home-button" id="btnHomePedidos">
        <div class="icon">üìã</div>
        Pedidos
      </button>
    </div>

    <!-- Cadastro form -->
    <div id="cadastro" class="hidden form-container">
      <h2>Novo Pedido</h2>
      <input type="text" id="nome" placeholder="Nome do cliente">
      <textarea id="descricao" placeholder="Descri√ß√£o do pedido"></textarea>
      <input type="date" id="prazoEntrega">
      <select id="situacao">
        <option value="afazer">A Fazer</option>
        <option value="fazendo">Fazendo</option>
        <option value="concluido">Conclu√≠do</option>
      </select>
      <button class="save-button" id="btnSalvar">Gravar Pedido</button>
      <button class="delete-button" id="btnExcluir">Excluir Pedido</button>
      <button class="back-button" id="btnVoltar1">Voltar</button>
    </div>

    <!-- Pedidos list -->
    <div id="pedidos" class="hidden list-container">
      <h2>Pedidos</h2>
      <input type="text" id="busca" placeholder="Buscar por nome...">
      <div style="display:flex; justify-content:space-around; margin:1rem 0;">
        <button class="pedido-button" data-status="todos">üìã Todos</button>
        <button class="pedido-button afazer" data-status="afazer">üü•</button>
        <button class="pedido-button fazendo" data-status="fazendo">üüß</button>
        <button class="pedido-button concluido" data-status="concluido">‚úÖ</button>
      </div>
      <div id="listaPedidos"></div>
      <button class="back-button" id="btnVoltar2">Voltar</button>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js';
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDDpJfDq7cnqf10CCa4VGSYNbkvPg-kHpQ",
      authDomain: "tudimapedidos.firebaseapp.com",
      projectId: "tudimapedidos",
      storageBucket: "tudimapedidos.appspot.com",
      messagingSenderId: "368667045110",
      appId: "1:368667045110:web:756e34bfe0f9af721e10d7",
      measurementId: "G-6XVGS0HH4D"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const pedidosRef = collection(db, 'pedidos');

    let pedidos = [], editandoId = null, filtroAtual = 'todos';
    const home = document.getElementById('home');
    const cad = document.getElementById('cadastro');
    const ped = document.getElementById('pedidos');

    document.getElementById('btnHomeCadastro').onclick = () => {
      home.classList.add('hidden');
      cad.classList.remove('hidden');
    };
    document.getElementById('btnHomePedidos').onclick = () => {
      home.classList.add('hidden');
      ped.classList.remove('hidden');
      renderList();
    };
    document.getElementById('btnVoltar1').onclick = () => {
      cad.classList.add('hidden');
      home.classList.remove('hidden');
    };
    document.getElementById('btnVoltar2').onclick = () => {
      ped.classList.add('hidden');
      home.classList.remove('hidden');
    };

    document.getElementById('btnSalvar').onclick = async () => {
      const nome = document.getElementById('nome').value.trim();
      const descricao = document.getElementById('descricao').value.trim();
      const prazoEntrega = document.getElementById('prazoEntrega').value;
      const situacao = document.getElementById('situacao').value;

      if (!nome || !descricao || !prazoEntrega) {
        alert('Preencha todos os campos.');
        return;
      }

      try {
        if (editandoId) {
          await updateDoc(doc(db, 'pedidos', editandoId), { nome, descricao, prazoEntrega, situacao });
        } else {
          await addDoc(pedidosRef, { nome, descricao, prazoEntrega, situacao });
        }
        cad.classList.add('hidden');
        home.classList.remove('hidden');
      } catch (e) {
        alert('Erro ao salvar pedido.');
      }
    };

    document.getElementById('btnExcluir').onclick = async () => {
      if (editandoId && confirm('Deseja excluir este pedido?')) {
        await deleteDoc(doc(db, 'pedidos', editandoId));
        cad.classList.add('hidden');
        home.classList.remove('hidden');
      }
    };

    onSnapshot(pedidosRef, (snapshot) => {
      pedidos = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
    });

    document.getElementById('busca').oninput = renderList;
    document.querySelectorAll('[data-status]').forEach(btn => {
      btn.onclick = () => { filtroAtual = btn.dataset.status; renderList(); };
    });

    function renderList() {
      const lista = document.getElementById('listaPedidos');
      const termo = document.getElementById('busca').value.toLowerCase();
      lista.innerHTML = '';
      pedidos.filter(p => (filtroAtual === 'todos' || p.situacao === filtroAtual) && p.nome.toLowerCase().includes(termo))
        .forEach(p => {
          const b = document.createElement('button');
          b.className = `pedido-button ${p.situacao}`;
          b.textContent = `${p.nome} ‚Äî ${p.prazoEntrega}`;
          b.onclick = () => {
            home.classList.add('hidden');
            cad.classList.remove('hidden');
            document.getElementById('nome').value = p.nome;
            document.getElementById('descricao').value = p.descricao;
            document.getElementById('prazoEntrega').value = p.prazoEntrega;
            document.getElementById('situacao').value = p.situacao;
            editandoId = p.id;
          };
          lista.appendChild(b);
        });
    }
  </script>
</body>
</html>

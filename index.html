<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tudima - Pedidos</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffc107">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Tudima - Pedidos">
  <meta name="application-name" content="Tudima - Pedidos">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('SW registrado:', reg))
          .catch(err => console.error('Erro SW:', err));
      });
    }
  </script>
  <style>
    body, html { height: 100%; margin: 0; font-family: Arial,sans-serif; background:#fff9cc; }
    header { text-align:center; padding:1rem; }
    .logo { max-width:150px; }
    #home { display:flex; gap:3rem; justify-content:center; align-items:center; height:80vh; }
    .home-button { background:#ffc107; border:none; border-radius:20px; width:160px; height:160px; display:flex; flex-direction:column; justify-content:center; align-items:center; color:#fff; font-weight:bold; font-size:1.2rem; cursor:pointer; box-shadow:0 4px 6px rgba(0,0,0,0.2); transition:background .3s; }
    .home-button:hover { background:#e6b800; }
    .home-button .icon { font-size:3.5rem; margin-bottom:.5rem; }
    .hidden { display:none!important; }
    .form-container, .list-container { width:90%; max-width:400px; margin:2rem auto; }
    input, textarea, select { width:100%; margin:.5rem 0; padding:.75rem; font-size:1rem; border:1px solid #ccc; border-radius:10px; }
    button { width:100%; padding:.8rem; font-size:1rem; border:none; border-radius:10px; margin-top:.5rem; cursor:pointer; color:#fff; }
    .save-button { background:#00c851; }
    .delete-button { background:#ff4444; }
    .back-button { background:#999; }
    .pedido-button { width:100%; margin:.3rem 0; padding:1rem; font-size:1.1rem; font-weight:bold; border:none; border-radius:10px; color:#fff; text-align:left; }
    .pedido-data { font-size:.9rem; color:#222; opacity:.7; }
    .afazer { background:#ff4444; }
    .fazendo { background:#ffbb33; }
    .concluido { background:#00c851; }
  </style>
</head>
<body>
  <header><img src="logo.png" alt="Tudima Logo" class="logo"></header>
  <main>
    <div id="home">
      <button class="home-button" id="btnHomeCadastro"><div class="icon">üìù</div>Cadastro</button>
      <button class="home-button" id="btnHomePedidos"><div class="icon">üìã</div>Pedidos</button>
    </div>
    <div id="cadastro" class="hidden form-container">
      <h2>Novo Pedido</h2>
      <input type="text" id="nome" placeholder="Nome do cliente">
      <textarea id="descricao" placeholder="Descri√ß√£o do pedido"></textarea>
      <input type="date" id="prazoEntrega">
      <select id="situacao"><option value="afazer">A Fazer</option><option value="fazendo">Fazendo</option><option value="concluido">Conclu√≠do</option></select>
      <button class="save-button" id="btnSalvar">Gravar Pedido</button>
      <button class="delete-button" id="btnExcluir">Excluir Pedido</button>
      <button class="back-button" id="btnVoltar1">Voltar</button>
    </div>
    <div id="pedidos" class="hidden list-container">
      <h2>Pedidos</h2>
      <input type="text" id="busca" placeholder="Buscar por nome...">
      <div style="display:flex;justify-content:space-around;margin:1rem 0;">
        <button class="pedido-button" data-status="todos">üìã Todos</button>
        <button class="pedido-button afazer" data-status="afazer">üü•</button>
        <button class="pedido-button fazendo" data-status="fazendo">üüß</button>
        <button class="pedido-button concluido" data-status="concluido">‚úÖ</button>
      </div>
      <div id="listaPedidos"></div>
      <button class="back-button" id="btnVoltar2">Voltar</button>
    </div>
  </main>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js';
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js';
    const firebaseConfig = { /* ... */ };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const pedidosRef = collection(db,'pedidos');
    let pedidos=[]; let editId=null; let filter='todos';
    const home=document.getElementById('home'), cad=document.getElementById('cadastro'), ped=document.getElementById('pedidos');
    document.getElementById('btnHomeCadastro').onclick=()=>{home.classList.add('hidden'); cad.classList.remove('hidden');};
    document.getElementById('btnHomePedidos').onclick=()=>{home.classList.add('hidden'); ped.classList.remove('hidden'); renderList();};
    document.getElementById('btnVoltar1').onclick=()=>{cad.classList.add('hidden'); home.classList.remove('hidden');};
    document.getElementById('btnVoltar2').onclick=()=>{ped.classList.add('hidden'); home.classList.remove('hidden');};
    document.getElementById('btnSalvar').onclick=async()=>{/* handle save with validations */};
    document.getElementById('btnExcluir').onclick=async()=>{/* handle delete */};
    onSnapshot(pedidosRef,snap=>{pedidos=snap.docs.map(d=>({id:d.id,...d.data()})); console.log('sync');});
    function renderList(){const l=document.getElementById('listaPedidos'); l.innerHTML=''; pedidos.filter(p=>filter==='todos'||p.situacao===filter).forEach(p=>{const b=document.createElement('button');b.className='pedido-button '+p.situacao; b.textContent=p.nome+' - '+p.prazoEntrega; b.onclick=()=>{home.classList.add('hidden'); cad.classList.remove('hidden');/* load p */};l.append(b);});}
    document.getElementById('busca').oninput=renderList;
    document.querySelectorAll('[data-status]').forEach(btn=>btn.onclick=()=>{filter=btn.dataset.status; renderList();});
  </script>
</body>
</html>
